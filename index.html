<!DOCTYPE html>
<script src="phonegap.js"></script>
<html>
<head>
    <title>Smart Mobility</title>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />

    <script type="text/javascript" src="watchPosition.js"></script>
    <script type="text/javascript" src="display.js"></script>

    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5/leaflet.css" />
    <script src="http://cdn.leafletjs.com/leaflet-0.5/leaflet.js"></script>

    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.0/jquery.mobile-1.3.0.min.css" />
    <script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
    <script src="jquery.mobile-1.3.0.min.js"></script>

    <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=AIzaSyAFRibImU7l2cmjIPF4S0yJ8r7YkxLeOHA&sensor=true"></script>

    <link rel="stylesheet" href="index.css" />

    <script type="text/javascript">
        var map;

        var myIcon = L.icon({
            iconUrl: 'position-marker.png',
            iconRetinaUrl: 'position-marker.png',
            iconSize: [15, 15]
        });

        var userMarker = new L.marker([0,0], {icon : myIcon});

        function successCallback(position){
            console.log("Latitude : " + position.coords.latitude + ", longitude : " + position.coords.longitude);
            userMarker.setLatLng(new L.LatLng(position.coords.latitude, position.coords.longitude));

        }

        function centerMap() {
            map.setView(userMarker.getLatLng(), 15);
        }

        var watchID = navigator.geolocation.watchPosition(successCallback, errorCallback, {frequency:1000, enableHighAccuracy:true});

        function initialize() {

            map = new L.Map('map_canvas');

            // create the tile layer with correct attribution
            var mapquestUrl = 'http://{s}.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.png';
            var subDomains = ['otile1','otile2','otile3','otile4'];
            var mapquestAttrib = '';
            var mapquest = new L.TileLayer(mapquestUrl, {maxZoom: 18, attribution: mapquestAttrib, subdomains: subDomains});

            map.setView(new L.LatLng(47.3, 2.47),8);

            userMarker.addTo(map);

            map.addLayer(mapquest);

            L.control.locate().addTo(map);
        }

        $('#carte').live('pageshow',function(event, ui){
            initialize();
            submitform();
        });


        function togglePOI1() {
            $("#poi1").toggle("fast", "linear", function (data) { });
        }

        function addAdr1(balise) {
            if (balise=="Home"){
                $("#adr1").val("26, rue pierre louvrier, clamart");
            }
             if (balise=="Work") {
                $("#adr1").val("2, avenue sully prud'homme, sceaux");
            }
            else if (balise=="Ma position") {
                $("#adr1").val("Ma position");
            }
            togglePOI1()
        }

        function togglePOI2() {
            $("#poi2").toggle("fast", "linear", function (data) {});
        }

        function addAdr2(balise) {
            if (balise=="Home"){
                $("#adr2").val("26, rue pierre louvrier, clamart");
            }
            else if (balise=="Work"){
                $("#adr2").val("2, avenue sully prud'homme, sceaux");
            }
            togglePOI2()
        };

    </script>

</head>
<body>

<div data-role="page" data-theme="a" id="accueil">
    <div data-role="header">
        <h1>Votre trajet</h1>
    </div><!-- /header -->

    <div data-role="fieldcontain">
        <input type="text" name="ip" id="ip" value="127.0.0.1"  placeholder="ip"/>
    </div>

    <div data-role="fieldcontain" style="margin-left: 10px;">
        <div class="ui-grid-a">
            <div class="ui-block-a">
                <input type="text" name="adr1" id="adr1" value="" data-theme="c" placeholder="Adresse de Départ"/>
            </div>
            <div class="ui-block-b" style="margin:0px;">
                <button data-icon="arrow-d" data-theme="c" onclick="togglePOI1()">Add</button>
            </div>
        </div>
    </div>

    <div id="poi1" data-role="fieldcontain" style="background-color: #adff2f; display: none">
        <input type="button" data-inline="true" value="Home" data-theme="c" onclick="addAdr1(this.value)"/>
        <input type="button" data-inline="true" value="Work" data-theme="c" onclick="addAdr1(this.value)"/>
        <input type="button" data-inline="true" value="Ma position" data-theme="c" onclick="addAdr1(this.value)"/>
    </div>

    <div data-role="fieldcontain" style="margin-left: 10px;">
        <div class="ui-grid-a">
            <div class="ui-block-a">
                <input type="text" name="adr2" id="adr2" value="" data-theme="c" placeholder="Adresse d'Arrivée"/>
            </div>
            <div class="ui-block-b">
                <button data-icon="arrow-d" data-theme="c" onclick="togglePOI2()" >Add</button>
            </div>
        </div>
    </div>

    <div id="poi2" data-role="fieldcontain" style="background-color: #adff2f; display: none">
        <input type="button" data-inline="true" value="Home" data-theme="c" onclick="addAdr2(this.value)"/>
        <input type="button" data-inline="true" value="Work" data-theme="c" onclick="addAdr2(this.value)"/>
    </div>

    <fieldset id="transportButtons"  data-role="controlgroup" data-type="horizontal">
        <label for="trans_choice_car">Car</label>
        <input type="radio" id="trans_choice_car"  name="trans" value="CAR"/>
        <label for="trans_choice_foot" >Foot</label>
        <input type="radio" id="trans_choice_foot"  name="trans" value="FOOT"/>
        <label for="trans_choice_cycle">Cycle</label>
        <input type="radio" id="trans_choice_cycle"  name="trans" value="BICYCLE"/>
    </fieldset>

    <div data-role="controlgroup" id="validateButton">
        <a href="map.html" data-role="button" data-icon="" data-transition="flip">Search</a>
    </div>
</div>
</body>
</html>

